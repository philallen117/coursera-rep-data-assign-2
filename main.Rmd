---
title: "Which weather events are the most harmful?"
author: "Phil Allen"
date: "22 January 2015"
output: html_document
---


## Synopsis: 

Immediately after the title, there should be a synopsis which describes and summarizes your analysis in at most 10 complete sentences.

## Data Processing 

which describes (in words and code) how the data were loaded into R and processed for analysis. In particular, your analysis must start from the raw CSV file containing the data. You cannot do any preprocessing outside the document. If preprocessing is time-consuming you may consider using the cache = TRUE option for certain code chunks.

```{r, cache=TRUE}
library("R.utils")
csvPath <- "data/StormData.csv"
bz2Path <- paste0(csvPath,".bz2")
if (!file.exists(bz2Path)) {
    download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", destfile = bz2Path)
}
if (!file.exists(csvPath)) {
  bunzip2(filename = bz2Path, destname = csvPath, remove = FALSE)
}
StormData <- read.csv("data/StormData.csv", stringsAsFactors = FALSE)
StormData$BGN_DATE <- strptime(StormData$BGN_DATE,"%m/%d/%Y", tz = "UTC")
StormData$END_DATE <- strptime(StormData$END_DATE,"%m/%d/%Y", tz = "UTC")
StormData$EVTYPE <- as.factor(StormData$EVTYPE)

```

```{r}
try2 <- StormData[1:10000,]
p <- ggplot(data = try2, aes(log(1 + FATALITIES), log(1 + PROPDMG)))
p + geom_point()

outcomes <- "cbind(FATALITIES, INJURIES, PROPDMG, CROPDMG)"
outcomes.time <- as.formula(paste0(outcomes," ~ year(BGN_DATE)"))
sums.time <- aggregate(outcomes.time, data = try2, FUN = sum)
outcomes.type <- as.formula(paste0(outcomes," ~ EVTYPE"))
means.type <- aggregate(outcomes.type, data = try2, FUN = mean)
tiles.type <- aggregate(FATALITIES ~ EVTYPE, data = try2, FUN = quantile, probs = (c(0.9, 0.99, 0.999))) # didn't work - try dplyr
# Try to plot several aes on same plot for different quant points with factor on x axis
# COnsider logs
library(dplyr)

```


## Results



## Exploration of the source data

```{r}
sort(names(StormData))
```




Evidence of very skew distribution in some key variables.

```{r}
summary(StormData$FATALITIES)
quantile(StormData$FATALITIES, c(0.9, 0.99, 0.999, 0.9999))
summary(StormData$MAG)
quantile(StormData$MAG, c(0.9, 0.99, 0.999, 0.9999))
```


